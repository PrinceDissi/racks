<link rel="import" href="/racks/elements/racks.html">
<racks-element name="details-toc">
    <style>
    :host {
        display: block;
        height: 100%;
        width: 100%;
        overflow-y: auto;
    }
    summary {
        position: relative;
        font-weight: 500;
        font-size: 16px;
        cursor: pointer;
        padding-left: 22px;
    }
    details-toc > ul {
        margin-left: 25px;
        display: none;
    }
    ul li a {
        display: block;
        padding: 4px 0;
    }
    ul .level-1 {
        margin-left: 10px;
    }
    ul .level-2 {
        margin-left: 20px;
    }
    details-toc > ul > li > a:first-child {
        margin-top: 4px;
    }
    summary:before {
        content: "";
        background-image: url('/racks/assets/ico/SVG/play.svg');
        background-size: 16px 16px;
        position: absolute;
        left: 0;
        top: 1px;
        width: 16px;
        height: 16px;
    }
    </style>
    <template>
        <content select="summary"></content>
        <content select="ul"></content>
    </template>
    <script>
        Racks('details-toc', {
            domReady: function(self) {
                var $this = $('details-toc');
                $this.append($('<ul></ul>'));

                var $capt = $this.find('summary'),
                $list = $this.find('ul'),
                content = '';

                if(!$capt) {
                    $this.append($('<summary>Table of Contents</summary>'));
                }

                // Open/Close the list
                $capt.on('click', function() {
                    $list.slideToggle();
                });

                var listItem = function(node, lvl, last) {
                    lvl = lvl - 2;
                    var it = '<li ';
                    it += 'class="level-' + lvl + '"><a ';
                    it += 'href="#' + node.attr('id') + '">';
                    it += node.text();
                    it += '</a></li>';
                    return it;
                };

                // Generate the list
                var $hs = $('h2,h3,h4,h5,h6'),
                last = null, i = 0;
                $hs.each(function() {
                    i++;
                    var $tag = $(this), toc = [];
                    if($tag.is('h2')) {
                        toc.push(listItem($tag, 2, last));
                        last = null;
                    } else if($tag.is('h3')) {
                        toc.push(listItem($tag, 3, last));
                        last = '2';
                    } else if($tag.is('h4')) {
                        toc.push(listItem($tag, 4, last));
                        last = '1';
                    } else if($tag.is('h5')) {

                    }
                    content += toc.join('');
                });
                $list.append($(content));
            }
        });
    </script>
</racks-element>
